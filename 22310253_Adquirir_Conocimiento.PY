import json      # Para guardar y leer el conocimiento en un archivo JSON
import os        # Para verificar si el archivo ya existe

# Nombre del archivo donde se guarda la base de conocimiento
BASE_FILE = "base_conocimiento.json"

# --- InicializaciÃ³n de la base de conocimiento ---
# Si el archivo aÃºn no existe, se crea con frases iniciales
if not os.path.exists(BASE_FILE):
    base = {
        "hola": "Â¡Hola! Â¿CÃ³mo estÃ¡s?",
        "como estas": "Muy bien, gracias. Â¿Y tÃº?",
        "de que te gustaria hablar": "Me encantan los carros, Â¿quieres hablar de motores, marcas o historia?",
    }
    # Guardamos la base inicial en el archivo JSON
    with open(BASE_FILE, "w", encoding="utf-8") as f:
        json.dump(base, f, indent=4, ensure_ascii=False)

# --- Cargar base de conocimiento existente ---
with open(BASE_FILE, "r", encoding="utf-8") as f:
    base = json.load(f)  # AquÃ­ se carga el contenido del archivo JSON en un diccionario


# --- FunciÃ³n para guardar la base de conocimiento ---
def guardar_conocimiento():
    """
    Esta funciÃ³n sobrescribe el archivo JSON
    con la base de conocimiento actualizada.
    """
    with open(BASE_FILE, "w", encoding="utf-8") as f:
        json.dump(base, f, indent=4, ensure_ascii=False)


# --- FunciÃ³n para responder al usuario ---
def responder(pregunta):
    """
    Busca si la pregunta existe en la base de conocimiento.
    - Si existe: devuelve la respuesta guardada.
    - Si no existe: pide al usuario que enseÃ±e una respuesta nueva,
      la guarda en el diccionario y la escribe en el archivo JSON.
    """
    pregunta = pregunta.lower().strip()  # Normalizamos la entrada (minÃºsculas y sin espacios extras)

    # Si la pregunta ya estÃ¡ en la base, devuelve la respuesta
    if pregunta in base:
        return base[pregunta]
    else:
        # Si no se encuentra, se activa el mÃ³dulo de adquisiciÃ³n de conocimiento
        print("No sÃ© quÃ© responder a eso ")
        nueva_resp = input(f"Â¿QuÃ© deberÃ­a contestar cuando me digan '{pregunta}'?\n>>> ")
        
        # Guardamos la nueva respuesta en la base
        base[pregunta] = nueva_resp
        guardar_conocimiento()  # Actualizamos el archivo JSON
        
        return f"Â¡Listo! AprendÃ­ algo nuevo: {nueva_resp}"


# --- Chat principal ---
print(" Bot Experto en Carros  (escribe 'salir' para terminar)\n")

# Ciclo infinito para mantener el chat activo
while True:
    user_input = input("TÃº: ")  # El usuario escribe su mensaje
    if user_input.lower() == "salir":  # CondiciÃ³n de salida
        print("Bot: Â¡Hasta luego, maneja con cuidado! ğŸš¦")
        break  # Se rompe el ciclo para terminar el chat

    # El bot genera una respuesta
    respuesta = responder(user_input)
    print("Bot:", respuesta)
